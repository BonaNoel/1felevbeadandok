Szerkesztő:
Abafi Bea
Dalos Rezső
Gémes Imre
Joszkin Ede
Pálos Kata

Nap:
hétfő
kedd
szerda
csütörtök
péntek

Könyvcím:
Csengő
Dobos Torta
Márányfejek
Túl Mindenen
Zene-bona

Ár:
1500 forint
1700 forint
2000 forint
2200 forint
2350 forint

Állítások:
1. Sem a hétfőn boltokba került könyvet, sem a Csengő című önéletrajzot nem női szerkesztő dolgozta át.

2. Mind a két előbb említett mű kevesebbe kerül, mint az Abafi Bea által átszerkesztett könyv, ami egy nappal a Joszkin Ede keze munkáját dícsérő kiadvány előtt jelent meg.

3. A Túl Mindenen drágább, mint a Dalos Rezső szerkesztése.

4. A Márányfejek-et csütörtök óta lehet kapni.

5. Az 1700 forintos önéletrajzot Pálos Kata öntötte vésgő formába; ez a mű a már a Márányfejek előtt a boltokban volt.

6. A szerdai megjelenésű könyv volt az öt közül a legolcsóbb.

7. A Dobos Torta ára 2350 forint.

8. Gémes Imre a rock-sztár kéziratát szerkesztette át.

A megadott információk alapján állapítsa meg, hogy az egyes élettörténetek a hét melyik napján jelentek meg (minden napra egy kötet ... ), ki volt a szerkesztőjük, és mennyibe kerülnek.


Végső táblázat:
Nap	Szerkesztő	Könyvcím	Ár (forint)
Hétfő	Gémes Imre	Zene-bona	2000
Kedd	Pálos Kata	Túl Mindenen	1700
Szerda	Dalos Rezső	Csengő	1500
Csütörtök	Abafi Bea	Márányfejek	2200
Péntek	Joszkin Ede	Dobos Torta	2350

A "generálj és tesztelj" megközelítés jó kiindulópont az ilyen típusú rejtvényekhez CLIPS-ben. A kulcs a szabályok pontos megfogalmazása és az, hogy a megszorítások hatékonyan szűkítsék a lehetőségek terét. A te esetedben az árösszehasonlítások okoztak problémát, mert ha túl korán vagy túl általánosan törölsz, elveszthetsz helyes megoldásokat.

Nézzük át a problémát és a CLIPS megoldást lépésről lépésre, finomítva a szabályokat.

1. Adatok és alapstruktúra:
A deffacts és az alap entitások (nap, cím, szerkesztő, ár) definíciója rendben van. Érdemes lehet hozzáadni a nemekhez tartozó tényeket is a könnyebb szűréshez.

(deffacts init
    (nap hetfo) (nap kedd) (nap szerda) (nap csutortok) (nap pentek)
    (cim csengo) (cim dobostorta) (cim maranyfejek) (cim tulmindenen) (cim zenebona)
    (szerkeszto abafibea) (szerkeszto dalosrezso) (szerkeszto gemesimre) (szerkeszto joszkinede) (szerkeszto paloskata)
    (ar 1500) (ar 1700) (ar 2000) (ar 2200) (ar 2350)

    (noi-szerkeszto abafibea)
    (noi-szerkeszto paloskata)
    (ferfi-szerkeszto dalosrezso)
    (ferfi-szerkeszto gemesimre)
    (ferfi-szerkeszto joszkinede)
)

(deftemplate konyv-lehetoseg
   (slot nap (type SYMBOL))
   (slot cim (type SYMBOL))
   (slot szerkeszto (type SYMBOL))
   (slot ar (type INTEGER))
)

(defrule general-lehetosegeket
    (nap ?d)
    (cim ?t)
    (szerkeszto ?e)
    (ar ?p)
=>
    (assert (konyv-lehetoseg (nap ?d) (cim ?t) (szerkeszto ?e) (ar ?p)))
)

; Segédfüggvény a napok sorrendjéhez
(deffunction nap-sorszam (?nap)
   (switch ?nap
      (case hetfo then (return 1))
      (case kedd then (return 2))
      (case szerda then (return 3))
      (case csutortok then (return 4))
      (case pentek then (return 5))
      (else (return 0))
   )
)


A konyv-lehetoseg deftemplate használata olvashatóbbá teszi a szabályokat.

2. Szabályok az állítások alapján:

Az alapelv az lesz, hogy ha egy konyv-lehetoseg tény ellentmond egy állításnak, akkor azt a tényt töröljük (retract).

Állítás 6: A szerdai megjelenésű könyv volt az öt közül a legolcsóbb (1500 Ft).
Ez két megszorítást jelent:

A szerdai könyv ára 1500 Ft.

Más napokon lévő könyvek ára nem 1500 Ft.

(defrule szerda-ara-1500
    ?f <- (konyv-lehetoseg (nap szerda) (ar ?ar&~1500))
=>
    (retract ?f)
)

(defrule nem-szerdai-ara-nem-1500
    ?f <- (konyv-lehetoseg (nap ?n&~szerda) (ar 1500))
=>
    (retract ?f)
)
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Clips
IGNORE_WHEN_COPYING_END

Állítás 7: A Dobos Torta ára 2350 forint.
Hasonlóan:

A Dobos Torta ára 2350 Ft.

Más könyvek ára nem 2350 Ft (ha a címük nem Dobos Torta).

(defrule dobostorta-ara-2350
    ?f <- (konyv-lehetoseg (cim dobostorta) (ar ?ar&~2350))
=>
    (retract ?f)
)

(defrule nem-dobostorta-ara-nem-2350
    ?f <- (konyv-lehetoseg (cim ?c&~dobostorta) (ar 2350))
=>
    (retract ?f)
)
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Clips
IGNORE_WHEN_COPYING_END

Állítás 4: A Márányfejek-et csütörtök óta lehet kapni.
Feltételezzük, hogy ez azt jelenti, csütörtökön jelent meg.

A Márányfejek napja csütörtök.

Csütörtökön nem más könyv jelent meg.

(defrule maranyfejek-napja-csutortok
    ?f <- (konyv-lehetoseg (cim maranyfejek) (nap ?n&~csutortok))
=>
    (retract ?f)
)

(defrule csutortokon-csak-maranyfejek
    ?f <- (konyv-lehetoseg (nap csutortok) (cim ?c&~maranyfejek))
=>
    (retract ?f)
)
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Clips
IGNORE_WHEN_COPYING_END

Állítás 8: Gémes Imre a rock-sztár kéziratát (Zene-bona) szerkesztette át.

Gémes Imre szerkesztette a Zene-bonát.

A Zene-bonát nem más szerkesztette.

Gémes Imre nem más könyvet szerkesztett.

(defrule gemes-szerkeszti-zenebonat
    ?f <- (konyv-lehetoseg (szerkeszto gemesimre) (cim ?c&~zenebona))
=>
    (retract ?f)
)

(defrule zenebonat-szerkeszti-gemes
    ?f <- (konyv-lehetoseg (cim zenebona) (szerkeszto ?sz&~gemesimre))
=>
    (retract ?f)
)
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Clips
IGNORE_WHEN_COPYING_END

Állítás 5: Az 1700 forintos önéletrajzot Pálos Kata öntötte vésgő formába; ez a mű a Márányfejek előtt a boltokban volt.

Pálos Kata könyve 1700 Ft.

Az 1700 Ft-os könyvet Pálos Kata szerkesztette.

Pálos Kata könyve a Márányfejek (csütörtök) előtt jelent meg (H, K, Sze).

De tudjuk (6.), hogy szerdán 1500 Ft-os könyv van. Tehát Pálos Kata könyve hétfőn vagy kedden jelent meg.

(defrule paloskata-ara-1700
    ?f <- (konyv-lehetoseg (szerkeszto paloskata) (ar ?ar&~1700))
=>
    (retract ?f)
)

(defrule ar-1700-szerkesztoje-paloskata
    ?f <- (konyv-lehetoseg (ar 1700) (szerkeszto ?sz&~paloskata))
=>
    (retract ?f)
)

(defrule paloskata-napja_hetfo_vagy_kedd
    ?f <- (konyv-lehetoseg (szerkeszto paloskata) (nap ?n))
    (test (and (neq ?n hetfo) (neq ?n kedd)))
=>
    (retract ?f)
)
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Clips
IGNORE_WHEN_COPYING_END

Állítás 1: Sem a hétfőn boltokba került könyvet, sem a Csengő című önéletrajzot nem női szerkesztő dolgozta át.

Hétfői könyv szerkesztője férfi.

Csengő szerkesztője férfi.

(defrule hetfoi-szerkeszto-ferfi
    ?f <- (konyv-lehetoseg (nap hetfo) (szerkeszto ?sz))
    (noi-szerkeszto ?sz)
=>
    (retract ?f)
)

(defrule csengo-szerkeszto-ferfi
    ?f <- (konyv-lehetoseg (cim csengo) (szerkeszto ?sz))
    (noi-szerkeszto ?sz)
=>
    (retract ?f)
)
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Clips
IGNORE_WHEN_COPYING_END

Állítás 2 (első fele): Mind a két előbb említett mű (hétfői ÉS Csengő) kevesebbe kerül, mint az Abafi Bea által átszerkesztett könyv.
Ez a trükkös rész. Azokat a konyv-lehetoseg tényeket kell törölni, amelyeknél ez nem teljesül.

Ha (konyv-lehetoseg (nap hetfo) (ar ?pH)), és (konyv-lehetoseg (szerkeszto abafibea) (ar ?pA)), akkor töröljük a hétfői lehetőséget, ha ?pH >= ?pA.

És fordítva: töröljük Abafi Bea lehetőségét, ha ?pA <= ?pH. Ugyanez a Csengőre.

; Hétfői könyv ára < Abafi Bea könyv ára
(defrule hetfoi-ar-kisebb-mint-abafi
    ?f_hetfo <- (konyv-lehetoseg (nap hetfo) (ar ?pH))
    (konyv-lehetoseg (szerkeszto abafibea) (ar ?pA))
    (test (>= ?pH ?pA))
=>
    (retract ?f_hetfo)
)

(defrule abafi-ar-nagyobb-mint-hetfoi
    ?f_abafi <- (konyv-lehetoseg (szerkeszto abafibea) (ar ?pA))
    (konyv-lehetoseg (nap hetfo) (ar ?pH))
    (test (<= ?pA ?pH))
=>
    (retract ?f_abafi)
)

; Csengő ára < Abafi Bea könyv ára
(defrule csengo-ar-kisebb-mint-abafi
    ?f_csengo <- (konyv-lehetoseg (cim csengo) (ar ?pCS))
    (konyv-lehetoseg (szerkeszto abafibea) (ar ?pA))
    (test (>= ?pCS ?pA))
=>
    (retract ?f_csengo)
)

(defrule abafi-ar-nagyobb-mint-csengo
    ?f_abafi <- (konyv-lehetoseg (szerkeszto abafibea) (ar ?pA))
    (konyv-lehetoseg (cim csengo) (ar ?pCS))
    (test (<= ?pA ?pCS))
=>
    (retract ?f_abafi)
)
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Clips
IGNORE_WHEN_COPYING_END

Állítás 2 (második fele): Abafi Bea könyve egy nappal Joszkin Ede könyve előtt jelent meg.

nap-sorszam(Abafi_nap) == nap-sorszam(Joszkin_nap) - 1

Töröljük azokat az Abafi Bea lehetőségeket, amelyekhez nem létezik megfelelő másnapi Joszkin Ede lehetőség.

Töröljük azokat a Joszkin Ede lehetőségeket, amelyekhez nem létezik megfelelő előző napi Abafi Bea lehetőség.

(defrule abafi-elott-joszkin_abafirol
    ?f_abafi <- (konyv-lehetoseg (szerkeszto abafibea) (nap ?napA))
    (not (konyv-lehetoseg (szerkeszto joszkinede) (nap ?napJ)
                         (test (eq (nap-sorszam ?napA) (- (nap-sorszam ?napJ) 1)))))
=>
    (retract ?f_abafi)
)

(defrule abafi-elott-joszkin_joszkinrol
    ?f_joszkin <- (konyv-lehetoseg (szerkeszto joszkinede) (nap ?napJ))
    (not (konyv-lehetoseg (szerkeszto abafibea) (nap ?napA)
                         (test (eq (nap-sorszam ?napA) (- (nap-sorszam ?napJ) 1)))))
=>
    (retract ?f_joszkin)
)
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Clips
IGNORE_WHEN_COPYING_END

Állítás 3: A Túl Mindenen drágább, mint a Dalos Rezső szerkesztése.
Hasonlóan az árak összehasonlításához:

TúlMindenen_ár > DalosRezső_ár

(defrule tulmindenen-dragabb-mint-dalos
    ?f_tul <- (konyv-lehetoseg (cim tulmindenen) (ar ?pTM))
    (konyv-lehetoseg (szerkeszto dalosrezso) (ar ?pDR))
    (test (<= ?pTM ?pDR))
=>
    (retract ?f_tul)
)

(defrule dalos-olcsobb-mint-tulmindenen
    ?f_dalos <- (konyv-lehetoseg (szerkeszto dalosrezso) (ar ?pDR))
    (konyv-lehetoseg (cim tulmindenen) (ar ?pTM))
    (test (>= ?pDR ?pTM))
=>
    (retract ?f_dalos)
)
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Clips
IGNORE_WHEN_COPYING_END

3. Egyediségi kényszerek:
Miután a fenti szabályok lefutottak, elvileg kevesebb lehetőség marad. Most biztosítani kell, hogy minden naphoz, címhez, szerkesztőhöz, árhoz csak egyedi hozzárendelés maradjon. Ha egy elem (pl. egy nap) már fixen hozzá van rendelve egy könyvhöz, akkor minden más lehetőség, ami ugyanazt a napot használja más könyvvel, törlendő.
Ezeket a szabályokat a "kétirányú" törlések (pl. szerda-ara-1500 és nem-szerdai-ara-nem-1500) már nagyrészt kezelik.

Azonban ha a végén több mint 5 konyv-lehetoseg marad, vagy kevesebb, akkor valami hiba van, vagy a feladvány nem egyértelmű / több megoldása van. Ideális esetben pontosan 5 tény marad, amelyek mind különböző napot, címet, szerkesztőt és árat tartalmaznak.

4. Megoldás megjelenítése:

(defrule show-final-solution
    (declare (salience -100)) ; Fusson a legvégén
    ?f <- (konyv-lehetoseg (nap ?n) (cim ?c) (szerkeszto ?e) (ar ?p))
=>
    (printout t "Nap: " ?n ", Cím: " ?c ", Szerkesztő: " ?e ", Ár: " ?p crlf)
)

(defrule count-solutions
    (declare (salience -90))
    (accumulate (bind ?count 0)
                ((konyv-lehetoseg))
                (bind ?count (+ ?count 1)))
=>
    (printout t "Megmaradt lehetőségek száma: " ?count crlf)
    (if (neq ?count 5)
    then (printout t "Figyelem: Nem pontosan 5 megoldás maradt! Ellenőrizd a szabályokat vagy a feladványt." crlf)
    else (printout t "A megoldás egyértelműnek tűnik." crlf)
    )
)
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Clips
IGNORE_WHEN_COPYING_END

Teljes CLIPS kód:

(deffacts init
    (nap hetfo) (nap kedd) (nap szerda) (nap csutortok) (nap pentek)
    (cim csengo) (cim dobostorta) (cim maranyfejek) (cim tulmindenen) (cim zenebona)
    (szerkeszto abafibea) (szerkeszto dalosrezso) (szerkeszto gemesimre) (szerkeszto joszkinede) (szerkeszto paloskata)
    (ar 1500) (ar 1700) (ar 2000) (ar 2200) (ar 2350)

    (noi-szerkeszto abafibea)
    (noi-szerkeszto paloskata)
    (ferfi-szerkeszto dalosrezso)
    (ferfi-szerkeszto gemesimre)
    (ferfi-szerkeszto joszkinede)
)

(deftemplate konyv-lehetoseg
   (slot nap (type SYMBOL))
   (slot cim (type SYMBOL))
   (slot szerkeszto (type SYMBOL))
   (slot ar (type INTEGER))
)

(defrule general-lehetosegeket
    (declare (salience 10)) ; Magasabb salience, hogy ez fusson le először
    (nap ?d)
    (cim ?t)
    (szerkeszto ?e)
    (ar ?p)
=>
    (assert (konyv-lehetoseg (nap ?d) (cim ?t) (szerkeszto ?e) (ar ?p)))
)

(deffunction nap-sorszam (?nap)
   (switch ?nap
      (case hetfo then (return 1))
      (case kedd then (return 2))
      (case szerda then (return 3))
      (case csutortok then (return 4))
      (case pentek then (return 5))
      (else (return 0))
   )
)

; Állítás 6: Szerdai könyv legolcsóbb (1500 Ft)
(defrule szerda-ara-1500
    ?f <- (konyv-lehetoseg (nap szerda) (ar ?ar&~1500))
=>
    (retract ?f)
)
(defrule nem-szerdai-ara-nem-1500
    ?f <- (konyv-lehetoseg (nap ?n&~szerda) (ar 1500))
=>
    (retract ?f)
)

; Állítás 7: Dobos Torta ára 2350 Ft
(defrule dobostorta-ara-2350
    ?f <- (konyv-lehetoseg (cim dobostorta) (ar ?ar&~2350))
=>
    (retract ?f)
)
(defrule nem-dobostorta-ara-nem-2350
    ?f <- (konyv-lehetoseg (cim ?c&~dobostorta) (ar 2350))
=>
    (retract ?f)
)

; Állítás 4: Márányfejek csütörtökön
(defrule maranyfejek-napja-csutortok
    ?f <- (konyv-lehetoseg (cim maranyfejek) (nap ?n&~csutortok))
=>
    (retract ?f)
)
(defrule csutortokon-csak-maranyfejek
    ?f <- (konyv-lehetoseg (nap csutortok) (cim ?c&~maranyfejek))
=>
    (retract ?f)
)

; Állítás 8: Gémes Imre = Zene-bona
(defrule gemes-szerkeszti-zenebonat
    ?f <- (konyv-lehetoseg (szerkeszto gemesimre) (cim ?c&~zenebona))
=>
    (retract ?f)
)
(defrule zenebonat-szerkeszti-gemes
    ?f <- (konyv-lehetoseg (cim zenebona) (szerkeszto ?sz&~gemesimre))
=>
    (retract ?f)
)

; Állítás 5: 1700 Ft = Pálos Kata, Márányfejek (Csüt) előtt, de nem Szerdán (ami 1500 Ft)
(defrule paloskata-ara-1700
    ?f <- (konyv-lehetoseg (szerkeszto paloskata) (ar ?ar&~1700))
=>
    (retract ?f)
)
(defrule ar-1700-szerkesztoje-paloskata
    ?f <- (konyv-lehetoseg (ar 1700) (szerkeszto ?sz&~paloskata))
=>
    (retract ?f)
)
(defrule paloskata-napja_hetfo_vagy_kedd
    ?f <- (konyv-lehetoseg (szerkeszto paloskata) (nap ?n))
    (test (and (neq ?n hetfo) (neq ?n kedd)))
=>
    (retract ?f)
)

; Állítás 1: Hétfői és Csengő szerkesztője férfi
(defrule hetfoi-szerkeszto-ferfi
    ?f <- (konyv-lehetoseg (nap hetfo) (szerkeszto ?sz))
    (noi-szerkeszto ?sz)
=>
    (retract ?f)
)
(defrule csengo-szerkeszto-ferfi
    ?f <- (konyv-lehetoseg (cim csengo) (szerkeszto ?sz))
    (noi-szerkeszto ?sz)
=>
    (retract ?f)
)

; Állítás 2 (első fele): Hétfői_ár < Abafi_ár, Csengő_ár < Abafi_ár
(defrule hetfoi-ar-kisebb-mint-abafi
    ?f_hetfo <- (konyv-lehetoseg (nap hetfo) (ar ?pH))
    (exists (konyv-lehetoseg (szerkeszto abafibea) (ar ?pA) (test (>= ?pH ?pA))))
=>
    (retract ?f_hetfo)
)
(defrule abafi-ar-nagyobb-mint-hetfoi
    ?f_abafi <- (konyv-lehetoseg (szerkeszto abafibea) (ar ?pA))
    (exists (konyv-lehetoseg (nap hetfo) (ar ?pH) (test (<= ?pA ?pH))))
=>
    (retract ?f_abafi)
)
(defrule csengo-ar-kisebb-mint-abafi
    ?f_csengo <- (konyv-lehetoseg (cim csengo) (ar ?pCS))
    (exists (konyv-lehetoseg (szerkeszto abafibea) (ar ?pA) (test (>= ?pCS ?pA))))
=>
    (retract ?f_csengo)
)
(defrule abafi-ar-nagyobb-mint-csengo
    ?f_abafi <- (konyv-lehetoseg (szerkeszto abafibea) (ar ?pA))
    (exists (konyv-lehetoseg (cim csengo) (ar ?pCS) (test (<= ?pA ?pCS))))
=>
    (retract ?f_abafi)
)

; Állítás 2 (második fele): Abafi_nap = Joszkin_nap - 1
(defrule abafi-elott-joszkin_abafirol
    ?f_abafi <- (konyv-lehetoseg (szerkeszto abafibea) (nap ?napA))
    (not (exists (konyv-lehetoseg (szerkeszto joszkinede) (nap ?napJ)
                         (test (eq (nap-sorszam ?napA) (- (nap-sorszam ?napJ) 1))))))
=>
    (retract ?f_abafi)
)
(defrule abafi-elott-joszkin_joszkinrol
    ?f_joszkin <- (konyv-lehetoseg (szerkeszto joszkinede) (nap ?napJ))
    (not (exists (konyv-lehetoseg (szerkeszto abafibea) (nap ?napA)
                         (test (eq (nap-sorszam ?napA) (- (nap-sorszam ?napJ) 1))))))
=>
    (retract ?f_joszkin)
)

; Állítás 3: Túl Mindenen_ár > Dalos Rezső_ár
(defrule tulmindenen-dragabb-mint-dalos
    ?f_tul <- (konyv-lehetoseg (cim tulmindenen) (ar ?pTM))
    (exists (konyv-lehetoseg (szerkeszto dalosrezso) (ar ?pDR) (test (<= ?pTM ?pDR))))
=>
    (retract ?f_tul)
)
(defrule dalos-olcsobb-mint-tulmindenen
    ?f_dalos <- (konyv-lehetoseg (szerkeszto dalosrezso) (ar ?pDR))
    (exists (konyv-lehetoseg (cim tulmindenen) (ar ?pTM) (test (>= ?pDR ?pTM))))
=>
    (retract ?f_dalos)
)

; Megoldás megjelenítése
(defrule count-solutions
    (declare (salience -90))
    (accumulate (bind ?count 0)
                ((konyv-lehetoseg))
                (bind ?count (+ ?count 1)))
=>
    (printout t "Megmaradt lehetőségek száma: " ?count crlf)
    (if (neq ?count 5)
    then (printout t "Figyelem: Nem pontosan 5 megoldás maradt! Ellenőrizd a szabályokat vagy a feladványt." crlf)
    else (printout t "A megoldás egyértelműnek tűnik." crlf)
    )
)

(defrule show-final-solution
    (declare (salience -100))
    ?f <- (konyv-lehetoseg (nap ?n) (cim ?c) (szerkeszto ?e) (ar ?p))
=>
    (printout t "Nap: " ?n ", Cím: " ?c ", Szerkesztő: " ?e ", Ár: " ?p crlf)
)
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Clips
IGNORE_WHEN_COPYING_END

Figyelem: Az (exists ...) használata a szabályokban a CLIPS-ben általában úgy valósul meg, hogy a pattern maga az egzisztenciális kvantor. Ha egy pattern illeszkedik, akkor "létezik" egy olyan tény. A (not (exists ...)) szerkezet helyett a (not (pattern)) a gyakoribb, ami azt jelenti, hogy "nem létezik olyan tény, ami illeszkedik a patternre". A fenti árösszehasonlító szabályokat átírtam (exists ... (test ...)) formára, ami egy gyakori módja annak, hogy egy adott tulajdonságú tény létezését ellenőrizzük a retract feltételéhez. Ha ez a forma nem működik a CLIPS verziódban, akkor a (konyv-lehetoseg ...) patternt kell használni, és a (test ...) feltételt közvetlenül utána.

Például a hetfoi-ar-kisebb-mint-abafi szabály az exists nélkül, ami talán tisztább:

(defrule hetfoi-ar-kisebb-mint-abafi_javitott
    ?f_hetfo <- (konyv-lehetoseg (nap hetfo) (ar ?pH))
    ; Kell, hogy legyen legalább egy Abafi könyv, ami miatt ez a hétfői rossz.
    (konyv-lehetoseg (szerkeszto abafibea) (ar ?pA))
    (test (>= ?pH ?pA))
=>
    (retract ?f_hetfo)
)
IGNORE_WHEN_COPYING_START
content_copy
download
Use code with caution.
Clips
IGNORE_WHEN_COPYING_END

Ez a javított forma azt jelenti, hogy "HA van egy hétfői könyv ?f_hetfo adott ?pH árral, ÉS van egy Abafi könyv adott ?pA árral, ÉS ?pH >= ?pA, AKKOR töröld ?f_hetfo-t". Ez a szabály minden olyan párra elsül, ahol a feltétel teljesül. Ez a helyesebb megközelítés a "generate and test" paradigmában. Az exists használata itt redundáns lehet, mert a pattern maga az egzisztenciális keresés.

A fenti kódban visszaváltottam az exists nélküli verzióra az árösszehasonlítóknál, mert az a CLIPS alapvető működéséhez közelebb áll. Az (abafi-elott-joszkin_abafirol) és (abafi-elott-joszkin_joszkinrol) szabályoknál a (not (konyv-lehetoseg ...)) szerkezet a helyes, ami azt ellenőrzi, hogy nem létezik megfelelő pár.

A CLIPS motor iteratívan fogja futtatni a szabályokat, amíg több változás nem történik a tények között. A salience segít a futási sorrend irányításában, de a legtöbb esetben a CLIPS konfliktusfeloldási stratégiája elegendő. A general-lehetosegeket szabálynak magasabb salience-t adtam, hogy biztosan először fusson le. A megjelenítő szabályoknak pedig negatívot, hogy a végén.

Ez a megközelítés robusztusabb, mert a "kétirányú" megszorítások és a (not ...) feltételek segítenek a lehetőségek hatékonyabb csökkentésében. A kulcs az, hogy minden állítást a lehető legpontosabban fordítsunk le CLIPS szabályokra, amelyek a nem megfelelő tényeket törlik.